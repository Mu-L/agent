version: "3"
services:

  mimir:
    image: grafana/mimir:2.9.0
    volumes:
      - ../../configs/mimir:/etc/mimir-config
    entrypoint:
      - /bin/mimir
      - -config.file=/etc/mimir-config/mimir.yaml
    ports:
      - "9009:9009"

  otel-collector:
    image: otel/opentelemetry-collector-contrib:0.85.0
    restart: always
    command: ["--config=/etc/otel-collector-contrib.yaml", ""]
    volumes:
      - ../../configs/otel-collector-contrib/otel-collector-contrib.yaml:/etc/otel-collector-contrib.yaml
    ports:
      - "4317:4317"   # OTLP gRPC receiver
      - "4318:4318"   # OTLP HTTP exporter

  otelgen:
    image: ghcr.io/krzko/otelgen:latest
    command:
      - --otel-exporter-otlp-endpoint=otel-collector:4317
      - metrics
      - counter
    ports:
      - "9001:9001"